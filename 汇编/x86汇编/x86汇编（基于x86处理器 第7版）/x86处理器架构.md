# 32位x86处理器

> 2.2节





## 操作模式

x86处理器，有三个主要的操作模式：

- 保护模式：
  - 保护模式是处理器的原生状态。
  - 所有的指令和特性都可用。
  - 分配给程序的独立内存区域称为段，处理器会阻止程序使用自身段之外的内存。
- 实地址模式：
- 系统管理模式



- 虚拟8086模式，为保护模式的特殊情况。

  



## 基本执行环境

### 地址空间

- 在32位保护模式下，一个任务或程序最大可寻址4GB的线性地址空间。
- 在实模式下，程序只能寻址1MB空间。



### 基本程序执行寄存器

![image-20220913205323258](x86%E5%A4%84%E7%90%86%E5%99%A8%E6%9E%B6%E6%9E%84.assets/image-20220913205323258.png)

上图中，8个通用寄存器，6个段寄存器，1个处理器状态标志寄存器（EFLAGS），一个指令指针寄存器（EIP）。





# 通用寄存器

通用寄存器（都是32位）：

- EAX、EBX、ECX、EDX

- EBP、ESP、ESI、EDI

  



## 寄存器的名称与访问

![image-20220913205432758](x86%E5%A4%84%E7%90%86%E5%99%A8%E6%9E%B6%E6%9E%84.assets/image-20220913205432758.png)

以EAX为例：

- EAX的低16位，在使用时可用AX表示。
- AX寄存器的高8位称为AH；AX的低8位称为AL。

![image-20220913205557920](x86%E5%A4%84%E7%90%86%E5%99%A8%E6%9E%B6%E6%9E%84.assets/image-20220913205557920.png)



==而其他通用寄存器，只能用32位或16位名称来访问==：

![image-20220913205635428](x86%E5%A4%84%E7%90%86%E5%99%A8%E6%9E%B6%E6%9E%84.assets/image-20220913205635428.png)



## 通用寄存器的特殊用法

- 乘除指令默认使用EAX寄存器。它常被称为拓展累加寄存器。
- CPU默认使用ECX作为循环计数器。
- ESP用于寻址堆栈数据。通常被称为拓展堆栈指针寄存器。
- ESI和EDI用于高速存储区传输指令。被称为拓展源变址寄存器和拓展目的变址寄存器。
- 高级语言通过EBP，来引用堆栈中的函数参数和局部变量。通常被称为拓展帧指针寄存器。



# 段寄存器

段寄存器（16位）：

- CS、SS、DS
- ES、FS、GS





- 在实模式下：

  段寄存器存放的是，内存区域的基址。

- 在保护模式下：

  段寄存器存放的是，段描述符表指针。



# 指令指针寄存器

指令指针寄存器（32位）：

- EIP



EIP存放的是下一条将要执行指令的地址。



# EFLAGS寄存器

> 32位



- 用于控制CPU的操作，或是反映一些CPU操作的结果。

- 有些指令可用测试和控制这些单独的处理器标志位。

- 1为置位，0为清除或重置。



- 控制标志位：控制CPU的操作。

  例如，它们能使得CPU每执行一条指令后进入中断；侦测到算术运算溢出时中断执行；进入保护模式；

- 状态标志位：

  反映CPU执行的算术或逻辑运算的结果。

  包含：溢出位、符号位、零标志位、辅助进位标志位、奇偶校验位、进位标志位。

  ![image-20220913210737449](x86%E5%A4%84%E7%90%86%E5%99%A8%E6%9E%B6%E6%9E%84.assets/image-20220913210737449.png)





# x86内存管理

- 实地址模式：
  - 只能寻址1MB内存，从00000H到FFFFFH。意味着可用访问那些与系统硬件相关的地址。
  - 处理器一次只能运行一个程序，但可用暂时中断程序，来处理外围设备的请求。
- 保护模式：
  - 处理器可用同时运行多个陈旭。
  - 为每个进程，分配4GB内存。
  - 每个程序都分配有自己的保留内存区域，禁止意外访问其他程序的数据和代码。



# 64位x86-64处理器

> x86-64指的是指令集，是对x86指令集的64位拓展。

x86-64指令集的特征：

1. 向后兼容x86指令集
2. 地址长度为64位，虚拟地址空间为$2^{64}$字节。
3. 可用使用64位通用寄存器，允许指令具有64位整数操作数。
4. 比x86多8个通用寄存器。
5. 物理地址为48位，支持256TB的RAM。



![image-20220913212044345](x86%E5%A4%84%E7%90%86%E5%99%A8%E6%9E%B6%E6%9E%84.assets/image-20220913212044345.png)

