# å¯åŠ¨çº¿ç¨‹

ç®€å•çš„è¯´ï¼Œä½¿ç”¨C++çº¿ç¨‹åº“å¯åŠ¨çº¿ç¨‹ï¼Œå°±æ˜¯æ„é€ `std::thread`å¯¹è±¡ã€‚



- ä¼ é€’å‡½æ•°ï¼š

  ```C++
  #include <iostream>
  #include <thread>
  
  void do_some_work(){
      std::cout << "hello" << std::endl;
  }
  
  int main(){
  	std::thread my_thread(do_some_work);
      my_thread.join();
  }
  ```

- ä¼ é€’å‡½æ•°å¯¹è±¡ï¼š

  ```C++
  #include <iostream>
  #include <thread>
  
  class background_task {
  public:
  	void operator()() const {
  		std::cout << "hello" << std::endl;
  	}
  };
  
  int main() {
  	background_task f;
  
  	std::thread t(f);
  	t.join();
  }
  ```

  >æä¾›çš„å‡½æ•°å¯¹è±¡ï¼Œå°†è¢«å¤åˆ¶åˆ°æ–°çº¿ç¨‹çš„å­˜å‚¨ç©ºé—´ã€‚

  > éœ€è¦æ³¨æ„ï¼šå½“ä¼ é€’ä¸´æ—¶å¯¹è±¡æ—¶ï¼ŒC++ç¼–è¯‘å™¨ä¼šå°†å…¶è§£æä¸ºå‡½æ•°å£°æ˜ï¼Œè€Œéå¯¹è±¡çš„å®šä¹‰ã€‚
  >
  > ```C++
  > std::thread my_thread(background_task());
  > ```
  >
  > ç›¸å½“äºå£°æ˜äº†ä¸€ä¸ªå‡½æ•°ï¼š
  >
  > - å‡½æ•°åä¸ºï¼šmy_thread
  > - è¿”å›ç±»å‹ä¸ºï¼šstd::thread
  > - å½¢å‚ä¸ºï¼šä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼ˆæŒ‡å‘æ²¡æœ‰å‚æ•°ï¼Œè¿”å›ç±»å‹ä¸ºbackground_taskå¯¹è±¡çš„å‡½æ•°ï¼‰
  >
  > è§£å†³æ–¹æ¡ˆï¼š
  >
  > - å¤šæ·»åŠ ä¸€ä¸ªæ‹¬å·ï¼š
  >
  >   ```C++
  >   std::thread my_thread((background_task()));
  >   ```
  >
  > - ä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨ï¼š
  >
  >   ```C++
  >   std::thread my_thread{background_task()};
  >   ```

- ä¼ é€’Lambdaè¡¨è¾¾å¼ï¼š

  ```C++
  int main() {
  	std::thread t([]{
  		std::cout << "hello" << std::endl;
  	});
  
  	t.join();
  }
  ```

  



# ç¡®ä¿çº¿ç¨‹æ‰€è®¿é—®æ•°æ®çš„æœ‰æ•ˆæ€§

å‡½æ•°å·²ç»è¿”å›ï¼Œçº¿ç¨‹ä¾æ—§è®¿é—®å±€éƒ¨å˜é‡ï¼š

```C++
struct func
{
	int& i;
	func(int& i_) : i(i_) {}
	void operator() ()
	{
		for (unsigned j = 0; j < 1000000; ++j)
		{
			do_something(i);	// 1 æ½œåœ¨è®¿é—®éšæ‚£ï¼šç©ºå¼•ç”¨
		}
	}
};
void oops()
{
	int some_local_state = 0;
	func my_func(some_local_state);
	std::thread my_thread(my_func);
	my_thread.detach();			// 2 ä¸ç­‰å¾…çº¿ç¨‹ç»“æŸ
}								// 3 æ–°çº¿ç¨‹å¯èƒ½è¿˜åœ¨è¿è¡Œ
```

åœ¨è¯¥ä»£ç ä¸­ï¼Œå·²ç»å†³å®šä¸ç­‰å¾…çº¿ç¨‹(ä½¿ç”¨äº†detach()â‘¡)ï¼Œæ‰€ä»¥å½“oops()å‡½æ•°æ‰§è¡Œå®Œæˆæ—¶â‘¢ï¼Œçº¿ç¨‹ä¸­çš„å‡½æ•°å¯èƒ½è¿˜åœ¨è¿è¡Œã€‚

å¦‚æœçº¿ç¨‹è¿˜åœ¨è¿è¡Œï¼Œå°±ä¼šå»è°ƒç”¨do_something(i)â‘ ï¼Œè¿™æ—¶å°±ä¼šè®¿é—®å·²ç»é”€æ¯çš„å˜é‡ã€‚  è¿™å°†å¯¼è‡´æœªå®šä¹‰çš„è¡Œä¸ºã€‚

|             ä¸»çº¿ç¨‹              |                            æ–°çº¿ç¨‹                            |
| :-----------------------------: | :----------------------------------------------------------: |
| ä½¿ç”¨some_local_stateæ„é€ my_func |                                                              |
|       å¼€å¯æ–°çº¿ç¨‹my_thread       |                                                              |
|              å¯åŠ¨               |                                                              |
|      è°ƒç”¨func::operator()       |                                                              |
|         å°†my_threadåˆ†ç¦»         | æ‰§è¡Œfunc::operator();å¯èƒ½ä¼šåœ¨do_somethingä¸­è°ƒç”¨some_local_stateçš„å¼•ç”¨ |
|      é”€æ¯some_local_state       |                           æŒç»­è¿è¡Œ                           |
|          é€€å‡ºoopså‡½æ•°           | æŒç»­æ‰§è¡Œfunc::operator()ï¼›å¯èƒ½ä¼šåœ¨do_somethingä¸­è°ƒç”¨ some_local_stateçš„å¼•ç”¨ --> å¯¼è‡´æœªå®šä¹‰è¡Œä¸º |



<font color="red">å¤„ç†æ–¹æ¡ˆï¼šå°†æ•°æ®ï¼Œå¤åˆ¶åˆ°çº¿ç¨‹ä¸­</font>ã€‚

> ### ğŸ’¡
>
> ä¸è¦ä½¿ç”¨ï¼Œè®¿é—®å±€éƒ¨å˜é‡çš„å‡½æ•°ï¼Œåˆ›å»ºçº¿ç¨‹å¯¹è±¡ã€‚



# ç­‰å¾…çº¿ç¨‹ç»“æŸ

2.1.2



