# å‚è€ƒèµ„æ–™

- [è§†é¢‘æ•™ç¨‹](https://www.bilibili.com/video/BV1Gh41187uR?spm_id_from=333.999.0.0&vd_source=be746efb77e979ca275e4f65f2d8cda3)



# Lambdaè¡¨è¾¾å¼

- ç”¨äºç®€åŒ–**åŒ¿åå†…éƒ¨ç±»**çš„ç¼–å†™ã€‚
- å…³æ³¨äºï¼šæ–¹æ³•å‚æ•°ä¸ç›¸åº”çš„è¡Œä¸º



## åŸºæœ¬æ ¼å¼

```java
(å‚æ•°åˆ—è¡¨)->{ä»£ç }
```



## æ¡ˆä¾‹

- ä¾‹ä¸€ï¼š

  - åˆ›å»ºçº¿ç¨‹â€”â€”åŒ¿åå†…éƒ¨ç±»ï¼š

    ```java
    new Thread(new Runnable(){
        @Overried
        public void run(){
    		System.out.println("running");
        }
    })
    ```

  - åˆ›å»ºçº¿ç¨‹â€”â€”Lambdaï¼š

    ```java
    new Thread(()->{
        System.out.println("running");
    });
    ```

- ä¾‹äºŒï¼šå¸¦è¿”å›å€¼

  ```java
  public static int calculateNum(IntBinaryOperator operator) {
      int a = 10;
      int b = 20;
      return operator.applyAsInt(a, b);
  }
  ```

  lambdaè°ƒç”¨ï¼š

  ```java
  calculateNum(((left, right) -> {
      return left * right;
  }));
  ```

  ```java
  calculateNum(((left, right) -> left * right));
  ```

  

## çœç•¥è§„åˆ™

- å‚æ•°ç±»å‹å¯ä»¥çœç•¥
- æ–¹æ³•ä½“åªæœ‰ä¸€å¥æ—¶ï¼š
  - returnå¯ä»¥çœç•¥
  - {} å’Œ ; å¯ä»¥çœç•¥
- å‚æ•°åªæœ‰ä¸€ä¸ªæ—¶ï¼š() å¯ä»¥çœç•¥



# Streamæµ

ç”¨äº**å¯¹é›†åˆæˆ–æ•°ç»„ï¼Œè¿›è¡Œé“¾å¼æµå¼çš„æ“ä½œ**ã€‚

> #### ğŸ’¡ æ³¨æ„åŒºåˆ«ï¼š
>
> - InputStream / OutputStreamï¼šå¯¹IOæµè¿›è¡Œæ“ä½œ
> - Stream: å¯¹é›†åˆè¿›è¡Œæ“ä½œ



## å‡†å¤‡æ¡ˆä¾‹æ•°æ®

- lombokä¾èµ–ï¼š

  ```xml
  <dependencies>
      <dependency>
          <groupId>org.projectlombok</groupId>
          <artifactId>lombok</artifactId>
          <version>1.18.24</version>
      </dependency>
  </dependencies>
  ```

- Authorï¼š

  ```java
  @Data
  @NoArgsConstructor
  @AllArgsConstructor
  @EqualsAndHashCode  // ç”¨äºåæœŸçš„å»é‡ä½¿ç”¨
  public class Author {
  
      private Long id;
      private String name;
      private Integer age;
      private String intro;   // ç®€ä»‹
      private List<Book> books;
  }
  ```

- Bookï¼š

  ```java
  @Data
  @NoArgsConstructor
  @AllArgsConstructor
  @EqualsAndHashCode  // ç”¨äºåæœŸçš„å»é‡ä½¿ç”¨
  public class Book {
  
      private Long id;
      private String name;
      private String category; // åˆ†ç±»
      private Integer score;
      private String intro;   // ç®€ä»‹
  }
  ```

- æµ‹è¯•ç±»ï¼š

  ```java
  public class Demo {
  
      private static List<Author> getAuthors() {
          // æ•°æ®åˆå§‹åŒ–
          Author author = new Author(1L, "è’™å¤š", 33, "ä¸€ä¸ªä»èœåˆ€ä¸­æ˜æ‚Ÿå“²ç†çš„ç¥–å®‰äºº", null);
          Author author2 = new Author(2L, "äºšç´¢", 15, "ç‹‚é£ä¹Ÿè¿½é€ä¸ä¸Šä»–çš„æ€è€ƒé€Ÿåº¦", null);
          Author author3 = new Author(3L, "æ˜“å¤§å¸ˆ", 14, "æ˜¯è¿™ä¸ªä¸–ç•Œåœ¨é™åˆ¶ä»–çš„æ€ç»´", null);
          Author author4 = new Author(4L, "æ˜“å¤§å¸ˆ", 14, "æ˜¯è¿™ä¸ªä¸–ç•Œåœ¨é™åˆ¶ä»–çš„æ€ç»´", null);
  
          // ä¹¦ç±åˆ—è¡¨
          List<Book> books1 = new ArrayList<>();
          List<Book> books2 = new ArrayList<>();
          List<Book> books3 = new ArrayList<>();
  
          books1.add(new Book(1L, "åˆ€çš„ä¸¤ä¾§æ˜¯å…‰æ˜ä¸é»‘æš—", "å“²å­¦ï¼Œçˆ±æƒ…", 88, "ç”¨ä¸€æŠŠåˆ€åˆ’åˆ†äº†çˆ±æ¨"));
          books1.add(new Book(2L, "ä¸€Â·ä¸ªäººä¸èƒ½æ­»åœ¨åŒä¸€æŠŠåˆ€ä¸‹", "ä¸ªäººæˆé•¿ï¼Œçˆ±æƒ…", 99, "è®²è¿°å¦‚ä½•ä»å¤±è´¥ä¸­æ˜æ‚ŸçœŸç†"));
  
          books2.add(new Book(3L, "é‚£é£å¹ä¸åˆ°çš„åœ°æ–¹", "å“²å­¦", 85, "å¸¦ä½ ç”¨æ€ç»´å»é¢†ç•¥ä¸–ç•Œçš„å°½å¤´"));
          books2.add(new Book(3L, "é‚£é£å¹ä¸åˆ°çš„åœ°æ–¹", "å“²å­¦", 85, "å¸¦ä½ ç”¨æ€ç»´å»é¢†ç•¥ä¸–ç•Œçš„å°½å¤´"));
          books2.add(new Book(4L, "å¹æˆ–ä¸å¹", "çˆ±æƒ…ï¼Œä¸ªäººä¼ è®°", 56, "ä¸€ä¸ªå“²å­¦å®¶çš„æ‹çˆ±è§‚æ³¨å®šå¾ˆéš¾æŠŠä»–æ‰€åœ¨çš„æ—¶ä»£ç†è§£"));
  
          books3.add(new Book(5L, "ä½ çš„å‰‘å°±æ˜¯æˆ‘çš„åˆ›", "çˆ±æƒ…", 56, "æ— æ³•æƒ³è±¡ä¸€ä¸ªæ­¦è€…èƒ½å¯¹ä»–çš„ä¼´å€¡è¿™ä¹ˆçš„å®½å®¹"));
          books3.add(new Book(6L, "é£ä¸å‰‘", "ä¸ªäººä¼ è®°", 100, "ä¸¤ä¸ªå“²å­¦å®¶çµé­‚å’Œè‚‰ä½“çš„ç¢°æ’ä¼šæ¿€èµ·æ€ä¹ˆæ ·çš„ç«èŠ±å‘¢ï¼Ÿ"));
          books3.add(new Book(6L, "é£ä¸å‰‘", "ä¸ªäººä¼ è®°", 100, "ä¸¤ä¸ªå“²å­¦å®¶çµé­‚å’Œè‚‰ä½“çš„ç¢°æ’ä¼šæ¿€èµ·æ€ä¹ˆæ ·çš„ç«èŠ±å‘¢ï¼Ÿ"));
  
          author.setBooks(books1);
          author2.setBooks(books2);
          author3.setBooks(books3);
          author4.setBooks(books3);
  
          return new ArrayList<>(Arrays.asList(author, author2, author3, author4));
      }
  }
  ```



## å¸¸è§æ“ä½œ

### 1. åˆ›å»ºæµ

- å•åˆ—é›†åˆï¼š`é›†åˆå¯¹è±¡.stream()`

  ```java
  List<Author> authors = getAuthors();
  Stream<Author> stream = authors.stream();
  ```

- æ•°ç»„ï¼š`Arrays.stream(æ•°ç»„)` æˆ– `Stream.of(æ•°ç»„)`

  ```java
  Integer[] arr = {1,2,3,4,5};
  Stream<Integer> stream1 = Arrays.stream(arr);
  Stream<Integer> stream2 = Stream.of(arr);
  ```

- åŒåˆ—é›†åˆï¼šè½¬æ¢ä¸ºå•åˆ—é›†åˆåå†åˆ›å»ºï¼š

  ```java
  Map<String,Integer> map = new HashMap<>();
  map.put("èœ¡ç¬”å°æ–°", 19);
  map.put("é»‘å­", 17);
  map.put("æ—¥å‘ç¿”é˜³", 16);
  
  Stream<Map.Entry<String, Integer>> stream = map.entrySet().stream();
  ```



### 2. ä¸­é—´æ“ä½œ

#### filter

å¯ä»¥å¯¹æµä¸­çš„å…ƒç´ æŒ‰æ¡ä»¶è¿‡æ»¤ï¼Œ**ç¬¦åˆè¿‡æ»¤æ¡ä»¶çš„æ‰èƒ½ç»§ç»­ç•™åœ¨æµä¸­**ã€‚



ä¾‹å¦‚ï¼šæ‰“å°æ‰€æœ‰å§“åé•¿åº¦å¤§äº 1 çš„ä½œå®¶çš„å§“åï¼š

```java
List<Author> authors = getAuthors();
authors.stream()
    .filter(author -> author.getName().length() > 1)
    .forEach(System.out::println);
```



#### map

å¯¹æµä¸­çš„å…ƒç´ ï¼Œ**è¿›è¡Œè®¡ç®—æˆ–è½¬æ¢**ã€‚



ä¾‹å¦‚ï¼šæ‰“å°æ‰€æœ‰ä½œå®¶çš„å§“åï¼š

```java
List<Author> authors = getAuthors();
authors.stream() 			// Stream<Author>
    .map(Author::getName)	// Stream<String>
    .forEach(System.out::println);
```



#### distinct

å¯ä»¥å»é™¤æµä¸­çš„é‡å¤å…ƒç´ ã€‚

> distinctæ–¹æ³•ï¼Œä¾èµ–äºObjectçš„equals()æ–¹æ³•ï¼Œå¯¹æµä¸­çš„å…ƒç´ åˆ¤æ–­æ˜¯å¦ç›¸åŒã€‚
>
> **å› æ­¤éœ€è¦é‡å†™equals()æ–¹æ³•**



ä¾‹å¦‚ï¼šæ‰“å°æ‰€æœ‰ä¸é‡å¤ä½œå®¶çš„å§“åï¼š

```java
List<Author> authors = getAuthors();
authors.stream()
    .distinct()
    .forEach(author -> System.out.println(author.getName()));
```



#### sorted

å¯ä»¥å¯¹æµä¸­çš„å…ƒç´ è¿›è¡Œæ’åºã€‚



ä¾‹å¦‚ï¼šå¯¹æµä¸­å…ƒç´ æŒ‰å¹´é¾„é™åºï¼Œä¸”ä¸èƒ½æœ‰é‡å¤å…ƒç´ ï¼š

```java
List<Author> authors = getAuthors();

authors.stream()
    .distinct()
    .sorted((o1, o2) -> o2.getAge() - o1.getAge())
    .forEach(System.out::println);
```



#### limit

è®¾ç½®æµçš„æœ€å¤§é•¿åº¦ï¼Œ**è¶…å‡ºçš„éƒ¨åˆ†å°†è¢«ä¸¢å¼ƒ**ã€‚



ä¾‹å¦‚ï¼šå¯¹æµä¸­çš„å…ƒç´ ï¼ŒæŒ‰å¹´é¾„é™åºï¼Œä¸”ä¸èƒ½é‡å¤ï¼Œæ‰“å°å¹´é¾„æœ€å¤§çš„ä¸¤ä¸ªä½œå®¶çš„å§“åï¼š

```java
List<Author> authors = getAuthors();

authors.stream()
    .distinct()
    .sorted((o1, o2) -> o2.getAge() - o1.getAge())
    .limit(2)
    .forEach(author -> System.out.println(author.getName()));
```



#### skip

è·³è¿‡æµä¸­çš„**å‰nä¸ªå…ƒç´ **ï¼Œè¿”å›å‰©ä¸‹çš„å…ƒç´ ã€‚



ä¾‹å¦‚ï¼šæ‰“å°é™¤æœ€å¤§å¹´é¾„è€…çš„å…¶ä»–ä½œå®¶ï¼Œä¸”ä¸èƒ½é‡å¤ï¼ŒæŒ‰å¹´é¾„é™åºï¼š

```java
List<Author> authors = getAuthors();

authors.stream()
    .distinct()
    .sorted((o1, o2) -> o2.getAge() - o1.getAge())
    .skip(1)
    .forEach(author -> System.out.println(author.getName()));
```



#### flatMap

- map()ï¼šä¸€ä¸ªå¯¹è±¡ï¼Œä»…å¯è¢«è½¬æ¢å‡ºå¦ä¸€ä¸ªå¯¹è±¡æ¥ä½œä¸ºæµä¸­çš„å…ƒç´ 

- flatMap()ï¼š**ä¸€ä¸ªå¯¹è±¡**ï¼Œå¯è½¬æ¢å‡º **å¤šä¸ªå¯¹è±¡** æ¥ä½œä¸ºæµä¸­çš„å…ƒç´ ã€‚

  > ä¹Ÿå¯ä»¥ç†è§£ä¸ºï¼šå°†å¤šä¸ªæµè¿›è¡Œæ‹¼æ¥ï¼Œ**è¿”å›æ‹¼æ¥åçš„æµ**



ä¾‹å¦‚ï¼šæ‰“å°æ‰€æœ‰ä¹¦ç±çš„å§“åï¼Œå¹¶è¦æ±‚å»é‡ï¼š

```java
List<Author> authors = getAuthors();

authors.stream()	// Stream<Author>
    .flatMap(author -> author.getBooks().stream()) // Stream<Book>
    .distinct()
    .forEach(book -> System.out.println(book.getName()));
```

![image-20220617165604975](%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B.assets/image-20220617165604975.png)



ä¾‹å¦‚ï¼šæ‰“å°æ‰€æœ‰ä¹¦ç±çš„åˆ†ç±»ã€‚è¦æ±‚å»é‡ï¼Œä¸”ç»“æœä¸­ä¸åŒ…å«â€œå“²å­¦â€ / â€œçˆ±æƒ…â€

```java
List<Author> authors = getAuthors();

authors.stream()
    .flatMap(author -> author.getBooks().stream())
    .flatMap(book -> Arrays.stream(book.getCategory().split(",")))
    .filter(s -> !(s.equals("å“²å­¦") || s.equals("çˆ±æƒ…")))
    .distinct()
    .forEach(System.out::println); 
```



### 3. ç»ˆç»“æ“ä½œ

#### foreach

å¯¹æµä¸­çš„å…ƒç´ è¿›è¡Œéå†æ“ä½œã€‚



#### count

è·å–æµä¸­å…ƒç´ çš„ä¸ªæ•°ã€‚



#### max & min

è·å–æµä¸­çš„æœ€å€¼ã€‚



ä¾‹å¦‚ï¼šåˆ†åˆ«è·å–ä¹¦ç±çš„æœ€é«˜åˆ†å’Œæœ€ä½åˆ†

```java
List<Author> authors = getAuthors();

Optional<Integer> max = authors.stream()
    .flatMap(author -> author.getBooks().stream())
    .map(book -> book.getScore())
    .max(Integer::compareTo);

System.out.println(max.get());
```



#### collect

å°†å½“å‰æµï¼Œ**è½¬æ¢ä¸ºä¸€ä¸ªé›†åˆ**ã€‚



ä¾‹å¦‚ï¼šè·å–ä¸€ä¸ªå­˜æ”¾æ‰€æœ‰ä½œè€…åç§°çš„Listé›†åˆï¼š

```java 
        List<Author> authors = getAuthors();

        List<String> collect = authors.stream()
                .map(author -> author.getName())
                .distinct()
                .collect(Collectors.toList());
```

> collect()æ–¹æ³•ï¼Œä¸€èˆ¬ä¼ å…¥`Collectors`å·¥å…·ç±»çš„æ–¹æ³•çš„è¿”å›å€¼ã€‚



ä¾‹å¦‚ï¼šè·å–ä¸€ä¸ªMapé›†åˆï¼Œkeyä¸ºä½œè€…åï¼Œvalueä¸ºList\<Book>

```java 
List<Author> authors = getAuthors();

Map<String, List<Book>> collect = authors.stream()
    .distinct()
    .collect(Collectors.toMap(
        author -> author.getName(),
        author -> author.getBooks()
    ));
```



#### æŸ¥æ‰¾ä¸åŒ¹é…

##### anyMatch

å¯ä»¥ç”¨æ¥åˆ¤æ–­æ˜¯å¦æœ‰ä»»æ„ç¬¦åˆåŒ¹é…æ¡ä»¶çš„å…ƒç´ ï¼Œç»“æœä¸ºbooleanç±»å‹ã€‚



ä¾‹å¦‚ï¼šåˆ¤æ–­æ˜¯å¦æœ‰å¹´é¾„åœ¨29ä»¥ä¸Šçš„ä½œå®¶ï¼š

```java 
List<Author> authors = getAuthors();
boolean flag = authors.stream()
    .anyMatch(author -> author.getAge() > 29);

System.out.println(flag);
```



##### allMatch

å¯ä»¥ç”¨æ¥åˆ¤æ–­æ˜¯å¦éƒ½ç¬¦åˆåŒ¹é…æ¡ä»¶ï¼Œç»“æœä¸ºbooleanç±»å‹ã€‚å¦‚æœéƒ½ç¬¦åˆç»“æœä¸ºtrueï¼Œå¦åˆ™ç»“æœä¸ºfalseã€‚



ä¾‹å¦‚ï¼šåˆ¤æ–­æ˜¯å¦æ‰€æœ‰çš„ä½œå®¶éƒ½æ˜¯æˆå¹´äººï¼š

```java

List<Author> authors = getAuthors();
boolean flag = authors.stream()
    .allMatch(author -> author.getAge() >= 18);

System.out.println(flag);
```



##### noneMatch

å¯ä»¥åˆ¤æ–­æµä¸­çš„å…ƒç´ æ˜¯å¦éƒ½ä¸ç¬¦åˆåŒ¹é…æ¡ä»¶ã€‚å¦‚æœéƒ½ä¸ç¬¦åˆç»“æœä¸ºtrueï¼Œå¦åˆ™ç»“æœä¸ºfalse



ä¾‹å¦‚ï¼šåˆ¤æ–­ä½œå®¶æ˜¯å¦éƒ½æ²¡æœ‰è¶…è¿‡100å²çš„ï¼š

```java 
List<Author> authors = getAuthors();
boolean b = authors.stream()
    .noneMatch(author -> author.getAge() > 100);

System.out.println(b);
```



##### findAny

è·å–æµä¸­çš„ä»»æ„ä¸€ä¸ªå…ƒç´ ã€‚è¯¥æ–¹æ³•**æ²¡æœ‰åŠæ³•ä¿è¯è·å–çš„ä¸€å®šæ˜¯æµä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ **ã€‚



ä¾‹å¦‚ï¼šè·å–ä»»æ„ä¸€ä¸ªå¹´é¾„å¤§äº18çš„ä½œå®¶ï¼Œå¦‚æœå­˜åœ¨å°±è¾“å‡ºä»–çš„åå­—

```java 
List<Author> authors = getAuthors();
Optional<Author> optionalAuthor = authors.stream()
    .filter(author -> author.getAge()>18)
    .findAny();

optionalAuthor.ifPresent(author -> System.out.println(author.getName()));
```



##### findFirst

è·å–æµä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚



ä¾‹å¦‚ï¼šè·å–ä¸€ä¸ªå¹´é¾„æœ€å°çš„ä½œå®¶ï¼Œå¹¶è¾“å‡ºä»–çš„å§“åã€‚

```java 
List<Author> authors = getAuthors();
Optional<Author> first = authors.stream()
    .sorted((o1, o2) -> o1.getAge() - o2.getAge())
    .findFirst();

first.ifPresent(author -> System.out.println(author.getName()));
```



#### reduceå½’å¹¶

å¯¹æµä¸­çš„æ•°æ®æŒ‰ç…§ä½ æŒ‡å®šçš„è®¡ç®—æ–¹å¼è®¡ç®—å‡ºä¸€ä¸ªç»“æœã€‚ï¼ˆç¼©å‡æ“ä½œï¼‰

reduceçš„ä½œç”¨æ˜¯æŠŠstreamä¸­çš„å…ƒç´ ç»™ç»„åˆèµ·æ¥ï¼š

- ä¼ å…¥ä¸€ä¸ªåˆå§‹å€¼ï¼Œå®ƒä¼šæŒ‰ç…§æˆ‘ä»¬çš„è®¡ç®—æ–¹å¼ä¾æ¬¡æ‹¿**æµä¸­çš„å…ƒç´ **å’Œ**åˆå§‹åŒ–å€¼**è¿›è¡Œè®¡ç®—ï¼Œè®¡ç®—ç»“æœå†å’Œåé¢çš„å…ƒç´ è®¡ç®—ã€‚



reduceä¸¤ä¸ªå‚æ•°çš„é‡è½½å½¢å¼å†…éƒ¨çš„è®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š

```java
T result = identity;
for (T element : this stream)
	result = accumulator.apply(result, element)
return result;
```

å…¶ä¸­identityå°±æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡æ–¹æ³•å‚æ•°ä¼ å…¥çš„åˆå§‹å€¼ï¼Œaccumulatorçš„applyå…·ä½“è¿›è¡Œä»€ä¹ˆè®¡ç®—ä¹Ÿæ˜¯æˆ‘ä»¬é€šè¿‡æ–¹æ³•å‚æ•°æ¥ç¡®å®šçš„



ä¾‹å¦‚ï¼šä½¿ç”¨reduceæ±‚æ‰€æœ‰ä½œè€…å¹´é¾„çš„å’Œ

```java
List<Author> authors = getAuthors();
Integer sum = authors.stream()
    .distinct()
    .map(author -> author.getAge())
    .reduce(0, (result, element) -> result + element);
System.out.println(sum);
```

ä¾‹å¦‚ï¼šä½¿ç”¨reduceæ±‚æ‰€æœ‰ä½œè€…ä¸­å¹´é¾„çš„æœ€å¤§å€¼ï¼š

```java
List<Author> authors = getAuthors();
Integer max = authors.stream()
    .map(author -> author.getAge())
    .reduce(Integer.MIN_VALUE, (result, element) -> result < element ? element : result);

System.out.println(max);
```



reduceä¸€ä¸ªå‚æ•°çš„é‡è½½å½¢å¼å†…éƒ¨çš„è®¡ç®—ï¼š

```java
boolean foundAny = false;
T result = null;
for (T element : this stream) {
    if (!foundAny) {
        foundAny = true;
        result = element;
    }
    else
        result = accumulator.apply(result, element);
}
return foundAny ? Optional.of(result) : Optional.empty();
```

>ç›¸è¾ƒäºä¸¤ä¸ªå‚æ•°çš„é‡è½½å½¢å¼ï¼Œåˆå§‹åŒ–å€¼é‡‡ç”¨æµä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ 



ä¾‹å¦‚ï¼šå¦‚æœç”¨ä¸€ä¸ªå‚æ•°çš„é‡è½½æ–¹æ³•å»æ±‚æœ€å°å€¼ä»£ç å¦‚ä¸‹ï¼š

```java
List<Author> authors = getAuthors();
Optional<Integer> minOptional = authors.stream()
    .map(author -> author.getAge())
    .reduce((result, element) -> result > element ? element : result);

minOptional.ifPresent(age-> System.out.println(age));
```



## æ³¨æ„äº‹é¡¹

- æƒ°æ€§æ±‚å€¼ï¼ˆå¦‚æœæ²¡æœ‰ç»ˆç»“æ“ä½œï¼Œæ²¡æœ‰ä¸­é—´æ“ä½œæ˜¯ä¸ä¼šå¾—åˆ°æ‰§è¡Œçš„ï¼‰
- æµæ˜¯ä¸€æ¬¡æ€§çš„ï¼ˆä¸€æ—¦ä¸€ä¸ªæµå¯¹è±¡ç»è¿‡ä¸€ä¸ªç»ˆç»“æ“ä½œåã€‚è¿™ä¸ªæµå°±ä¸èƒ½å†è¢«ä½¿ç”¨ï¼‰
- ä¸ä¼šå½±å“åŸæ•°æ®ï¼ˆæˆ‘ä»¬åœ¨æµä¸­å¯ä»¥å¤šæ•°æ®åšå¾ˆå¤šå¤„ç†ã€‚ä½†æ˜¯æ­£å¸¸æƒ…å†µä¸‹æ˜¯ä¸ä¼šå½±å“åŸæ¥é›†åˆä¸­çš„å…ƒç´ çš„ã€‚è¿™å¾€å¾€ä¹Ÿæ˜¯æˆ‘ä»¬æœŸæœ›çš„ï¼‰



# Optional

## åˆ›å»ºå¯¹è±¡

Optionalå°±å¥½åƒæ˜¯åŒ…è£…ç±»ï¼Œå¯ä»¥æŠŠæˆ‘ä»¬çš„å…·ä½“æ•°æ®å°è£…Optionalå¯¹è±¡å†…éƒ¨ã€‚ç„¶åæˆ‘ä»¬å»ä½¿ç”¨Optionalä¸­å°è£…å¥½çš„æ–¹æ³•æ“ä½œå°è£…è¿›å»çš„æ•°æ®å°±å¯ä»¥éå¸¸ä¼˜é›…çš„é¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚



- ä¸€èˆ¬ä½¿ç”¨**Optional**çš„**é™æ€æ–¹æ³•ofNullable**æ¥æŠŠæ•°æ®å°è£…æˆä¸€ä¸ªOptionalå¯¹è±¡ã€‚æ— è®ºä¼ å…¥çš„å‚æ•°æ˜¯å¦ä¸ºnulléƒ½ä¸ä¼šå‡ºç°é—®é¢˜ã€‚

  ```java 
  Author author = getAuthor();
  Optional<Author> authorOptional = Optional.ofNullable(author);
  ```

  >Mybatisä»3.5ç‰ˆæœ¬å¯ä»¥ä¹Ÿå·²ç»æ”¯æŒOptionaläº†ã€‚
  >
  >å¯ä»¥ç›´æ¥æŠŠdaoæ–¹æ³•çš„è¿”å›å€¼ç±»å‹å®šä¹‰æˆOptionalç±»å‹ï¼ŒMyBastisä¼šè‡ªå·±æŠŠæ•°æ®å°è£…æˆOptionalå¯¹è±¡è¿”å›ã€‚

- å¦‚æœä½ **ç¡®å®šä¸€ä¸ªå¯¹è±¡ä¸æ˜¯ç©º**çš„ï¼Œåˆ™å¯ä»¥ä½¿ç”¨**Optional**çš„**é™æ€æ–¹æ³•of**æ¥æŠŠæ•°æ®å°è£…æˆOptionalå¯¹è±¡

      Author author = new Author();
      Optional<Author> authorOptional = Optional.of(author);

  > è‹¥ä¼ å…¥å¯¹è±¡ä¸ºnullï¼Œåˆ™æŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚

- å¦‚æœéœ€è¦è¿”å›nullï¼Œå¯ä»¥å°†å…¶åŒ…è£…ä¸ºOptionalå¯¹è±¡è¿”å›ã€‚ä½¿ç”¨**Optional**çš„**é™æ€æ–¹æ³•empty**æ¥è¿›è¡Œå°è£…ï¼š

  ```java
  Optional.empty()
  ```



## å®‰å…¨çš„æ¶ˆè´¹å€¼ ifPresent

è¿™ä¸ªæ–¹æ³•ä¼šåˆ¤æ–­å…¶å†…å°è£…çš„æ•°æ®æ˜¯å¦ä¸ºç©ºï¼Œä¸ä¸ºç©ºæ—¶æ‰ä¼šæ‰§è¡Œå…·ä½“çš„æ¶ˆè´¹ä»£ç ã€‚



ä¾‹å¦‚,ä»¥ä¸‹å†™æ³•å°±ä¼˜é›…çš„é¿å…äº†ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼š

```java
Optional<Author> authorOptional = Optional.ofNullable(getAuthor());

authorOptional.ifPresent(author -> System.out.println(author.getName()));
```



## è·å–å€¼ get

- å¦‚æœæˆ‘ä»¬æƒ³è·å–å€¼è‡ªå·±è¿›è¡Œå¤„ç†å¯ä»¥ä½¿ç”¨getæ–¹æ³•è·å–ï¼Œä½†æ˜¯**ä¸æ¨è**ã€‚

- å› ä¸ºå½“Optionalå†…éƒ¨çš„æ•°æ®ä¸ºç©ºçš„æ—¶å€™ä¼šå‡ºç°å¼‚å¸¸ã€‚



## å®‰å…¨è·å–å€¼ orElseGet / orElseThrow

å¦‚æœæˆ‘ä»¬æœŸæœ›å®‰å…¨çš„è·å–å€¼ã€‚æˆ‘ä»¬ä¸æ¨èä½¿ç”¨getæ–¹æ³•ï¼Œè€Œæ˜¯ä½¿ç”¨Optionalæä¾›çš„ä»¥ä¸‹æ–¹æ³•ï¼š

- orElseGet

  è·å–æ•°æ®å¹¶ä¸”è®¾ç½®æ•°æ®ä¸ºç©ºæ—¶çš„é»˜è®¤å€¼ã€‚

  - å¦‚æœæ•°æ®ä¸ä¸ºç©ºå°±èƒ½è·å–åˆ°è¯¥æ•°æ®ã€‚
  - å¦‚æœä¸ºç©ºåˆ™æ ¹æ®ä½ ä¼ å…¥çš„å‚æ•°æ¥åˆ›å»ºå¯¹è±¡ä½œä¸ºé»˜è®¤å€¼è¿”å›ã€‚

  ```java
  Optional<Author> authorOptional = Optional.ofNullable(getAuthor());
  Author author1 = authorOptional.orElseGet(() -> new Author());
  ```

- orElseThrow

  - è·å–æ•°æ®ï¼Œå¦‚æœæ•°æ®ä¸ä¸ºç©ºå°±èƒ½è·å–åˆ°è¯¥æ•°æ®ã€‚

  - å¦‚æœä¸ºç©ºåˆ™æ ¹æ®ä½ ä¼ å…¥çš„å‚æ•°æ¥åˆ›å»ºå¼‚å¸¸æŠ›å‡ºã€‚

  ```java
  Optional<Author> authorOptional = Optional.ofNullable(getAuthor());
  try {
      Author author = authorOptional.orElseThrow((Supplier<Throwable>) () -> new RuntimeException("authorä¸ºç©º"));
      System.out.println(author.getName());
  } catch (Throwable throwable) {
      throwable.printStackTrace();
  }
  ```

  



## è¿‡æ»¤ filter

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨filteræ–¹æ³•å¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤ã€‚

- å¦‚æœåŸæœ¬æ˜¯æœ‰æ•°æ®çš„ï¼Œ**ä½†æ˜¯ä¸ç¬¦åˆåˆ¤æ–­**ï¼Œä¹Ÿä¼šå˜æˆä¸€ä¸ªæ— æ•°æ®çš„Optionalå¯¹è±¡ã€‚



```java
Optional<Author> authorOptional = Optional.ofNullable(getAuthor());
authorOptional
    .filter(author -> author.getAge() > 100)
    .ifPresent(author -> System.out.println(author.getName()));
```



## åˆ¤æ–­ isPresent

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨isPresentæ–¹æ³•è¿›è¡Œæ˜¯å¦å­˜åœ¨æ•°æ®çš„åˆ¤æ–­ï¼š

- å¦‚æœä¸ºç©ºè¿”å›å€¼ä¸ºfalseï¼›å¦‚æœä¸ä¸ºç©ºï¼Œè¿”å›å€¼ä¸ºtrueã€‚

> **æ›´æ¨èä½¿ç”¨ifPresentæ–¹æ³•**ã€‚



```java
Optional<Author> authorOptional = Optional.ofNullable(getAuthor());

if (authorOptional.isPresent()) {
    System.out.println(authorOptional.get().getName());
}
```



## æ•°æ®è½¬æ¢ map

Optionalè¿˜æä¾›äº†mapå¯ä»¥è®©æˆ‘ä»¬çš„å¯¹æ•°æ®è¿›è¡Œè½¬æ¢ï¼Œå¹¶ä¸”è½¬æ¢å¾—åˆ°çš„æ•°æ®ä¹Ÿè¿˜æ˜¯è¢«OptionalåŒ…è£…å¥½çš„ï¼Œä¿è¯äº†æˆ‘ä»¬çš„ä½¿ç”¨å®‰å…¨ã€‚



ä¾‹å¦‚ï¼šè·å–ä½œå®¶çš„ä¹¦ç±é›†åˆï¼š

```java
private static void testMap() {
    Optional<Author> authorOptional = getAuthorOptional();
    Optional<List<Book>> optionalBooks = authorOptional.map(author -> author.getBooks());
    optionalBooks.ifPresent(books -> System.out.println(books));
}
```



# å‡½æ•°å¼æ¥å£

**åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•**çš„æ¥å£æˆ‘ä»¬ç§°ä¹‹ä¸ºå‡½æ•°æ¥å£ã€‚

>- JDKçš„å‡½æ•°å¼æ¥å£éƒ½åŠ ä¸Šäº†**@FunctionalInterface** æ³¨è§£è¿›è¡Œæ ‡è¯†ã€‚



## å¸¸è§å‡½æ•°å¼æ¥å£	

- Consumer æ¶ˆè´¹æ¥å£ï¼šåœ¨æ–¹æ³•ä¸­å¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œæ¶ˆè´¹

  <img src="%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B.assets/image-20220617184505363.png" alt="image-20220617184505363" style="zoom:50%;" />

- Function è®¡ç®—è½¬æ¢æ¥å£ï¼šåœ¨æ–¹æ³•ä¸­å¯¹ä¼ å…¥çš„å‚æ•°è®¡ç®—æˆ–è½¬æ¢ï¼ŒæŠŠç»“æœè¿”å›

  <img src="%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B.assets/image-20220617184509667.png" alt="image-20220617184509667" style="zoom:50%;" />

- Predicate åˆ¤æ–­æ¥å£ï¼šåœ¨æ–¹æ³•ä¸­å¯¹ä¼ å…¥çš„å‚æ•°æ¡ä»¶åˆ¤æ–­ï¼Œè¿”å›åˆ¤æ–­ç»“æœ

  <img src="%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B.assets/image-20220617184513835.png" alt="image-20220617184513835" style="zoom:50%;" />

- Supplier ç”Ÿäº§å‹æ¥å£ï¼šåœ¨æ–¹æ³•ä¸­åˆ›å»ºå¯¹è±¡ï¼ŒæŠŠåˆ›å»ºå¥½çš„å¯¹è±¡è¿”å›

  <img src="%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B.assets/image-20220617184518674.png" alt="image-20220617184518674" style="zoom:50%;" />



## Functionçš„ä¸ã€æˆ–ã€é

- andï¼š

  æ‰“å°ä½œå®¶ä¸­å¹´é¾„å¤§äº17å¹¶ä¸”å§“åçš„é•¿åº¦å¤§äº1çš„ä½œå®¶ï¼š

  ```java
  List<Author> authors = getAuthors();
  Stream<Author> authorStream = authors.stream();
  authorStream.filter(new Predicate<Author>() {
      @Override
      public boolean test(Author author) {
          return author.getAge()>17;
      }
  }.and(new Predicate<Author>() {
      @Override
      public boolean test(Author author) {
          return author.getName().length()>1;
      }
  })).forEach(author -> System.out.println(author));
  ```

- orï¼š

  æ‰“å°ä½œå®¶ä¸­å¹´é¾„å¤§äº17æˆ–è€…å§“åçš„é•¿åº¦å°äº2çš„ä½œå®¶ã€‚

  ```java
  List<Author> authors = getAuthors();
  authors.stream()
      .filter(new Predicate<Author>() {
          @Override
          public boolean test(Author author) {
              return author.getAge()>17;
          }
      }.or(new Predicate<Author>() {
          @Override
          public boolean test(Author author) {
              return author.getName().length()<2;
          }
      })).forEach(author -> System.out.println(author.getName()));
  ```

- negateï¼š

  æ‰“å°ä½œå®¶ä¸­å¹´é¾„ä¸å¤§äº17çš„ä½œå®¶ã€‚

  ```java
  List<Author> authors = getAuthors();
  authors.stream()
      .filter(new Predicate<Author>() {
          @Override
          public boolean test(Author author) {
              return author.getAge()>17;
          }
      }.negate()).forEach(author -> System.out.println(author.getAge()));
  ```

  

# æ–¹æ³•å¼•ç”¨

## å¼•ç”¨ç±»çš„é™æ€æ–¹æ³•

```java
ç±»å::æ–¹æ³•å
```



ä½¿ç”¨å‰æï¼š

- åœ¨é‡å†™æ–¹æ³•æ—¶ï¼Œ**æ–¹æ³•ä½“åªæœ‰ä¸€è¡Œ**
- è¯¥è¡Œä»£ç ï¼Œè°ƒç”¨äº†**æŸä¸ªç±»çš„é™æ€æ–¹æ³•**
- æ–¹æ³•ä¸­çš„**æ‰€æœ‰å½¢å‚ï¼Œéƒ½æŒ‰é¡ºåºä¼ å…¥**è¯¥é™æ€æ–¹æ³•



ä¾‹å¦‚ï¼š

```java
authorStream.map(author -> author.getAge())
    .map(age->String.valueOf(age));
```

```java
authorStream.map(author -> author.getAge())
    .map(String::valueOf);
```



## å¼•ç”¨å¯¹è±¡çš„å®ä¾‹æ–¹æ³•

```java
å¯¹è±¡å::æ–¹æ³•å
```



ä½¿ç”¨å‰æï¼š

- åœ¨é‡å†™æ–¹æ³•æ—¶ï¼Œ**æ–¹æ³•ä½“åªæœ‰ä¸€è¡Œ**
- è¿™è¡Œä»£ç æ˜¯**è°ƒç”¨äº†æŸä¸ªå¯¹è±¡çš„æˆå‘˜æ–¹æ³•**
- æ–¹æ³•ä¸­çš„**æ‰€æœ‰å½¢å‚ï¼Œéƒ½æŒ‰é¡ºåºä¼ å…¥**è¯¥æˆå‘˜æ–¹æ³•



ä¾‹å¦‚ï¼š

```java
List<Author> authors = getAuthors();

Stream<Author> authorStream = authors.stream();
StringBuilder sb = new StringBuilder();
authorStream.map(author -> author.getName())
    .forEach(name->sb.append(name));
```

```java
List<Author> authors = getAuthors();

Stream<Author> authorStream = authors.stream();
StringBuilder sb = new StringBuilder();
authorStream.map(author -> author.getName())
    .forEach(sb::append);
```



## å¼•ç”¨ç±»çš„å®ä¾‹æ–¹æ³•

- åœ¨é‡å†™æ–¹æ³•æ—¶ï¼Œ**æ–¹æ³•ä½“åªæœ‰ä¸€è¡Œ**
- è¿™è¡Œä»£ç æ˜¯**è°ƒç”¨äº†<u>ç¬¬ä¸€ä¸ªå½¢å‚å¯¹è±¡</u>çš„æˆå‘˜æ–¹æ³•**
- æ–¹æ³•ä¸­çš„**<u>å‰©ä½™</u>å½¢å‚ï¼Œéƒ½æŒ‰é¡ºåºä¼ å…¥**è¯¥æˆå‘˜æ–¹æ³•



ä¾‹å¦‚ï¼š
```java
interface UseString{
    String use(String str,int start,int length);
}

public static String subAuthorName(String str, UseString useString){
    int start = 0;
    int length = 1;
    return useString.use(str,start,length);
}
public static void main(String[] args) {

    subAuthorName("ä¸‰æ›´è‰å ‚", new UseString() {
        @Override
        public String use(String str, int start, int length) {
            return str.substring(start,length);
        }
    });

}
```

```java
public static void main(String[] args) {

    subAuthorName("ä¸‰æ›´è‰å ‚", String::substring);
}
```



## æ„é€ å™¨å¼•ç”¨

```java
ç±»å::new
```



ä½¿ç”¨å‰æï¼š

- åœ¨é‡å†™æ–¹æ³•æ—¶ï¼Œ**æ–¹æ³•ä½“åªæœ‰ä¸€è¡Œ**
- è¿™è¡Œä»£ç æ˜¯**è°ƒç”¨äº†æŸä¸ªç±»çš„æ„é€ æ–¹æ³•**
- æ‰€æœ‰å½¢å‚ï¼Œéƒ½ç”¨äºè°ƒç”¨æ„é€ æ–¹æ³•



```java
List<Author> authors = getAuthors();
authors.stream()
    .map(author -> author.getName())
    .map(name->new StringBuilder(name))
    .map(sb->sb.append("-ä¸‰æ›´").toString())
    .forEach(str-> System.out.println(str));
```

```java
List<Author> authors = getAuthors();
authors.stream()
    .map(author -> author.getName())
    .map(StringBuilder::new)
    .map(sb->sb.append("-ä¸‰æ›´").toString())
    .forEach(str-> System.out.println(str));
```



# ä¼˜åŒ–

## åŸºæœ¬æ•°æ®ç±»å‹ä¼˜åŒ–

- æˆ‘ä»¬ä¹‹å‰ç”¨åˆ°çš„å¾ˆå¤šStreamçš„æ–¹æ³•ç”±äºéƒ½ä½¿ç”¨äº†æ³›å‹ã€‚

  æ‰€ä»¥æ¶‰åŠåˆ°çš„å‚æ•°å’Œè¿”å›å€¼éƒ½æ˜¯å¼•ç”¨æ•°æ®ç±»å‹ã€‚

- è£…ç®±å’Œæ‹†ç®±æ˜¯è¦æ¶ˆè€—æ—¶é—´çš„

- ä¸ºäº†è®©æˆ‘ä»¬èƒ½å¤Ÿå¯¹è¿™éƒ¨åˆ†çš„æ—¶é—´æ¶ˆè€—è¿›è¡Œä¼˜åŒ–

  Streamè¿˜æä¾›äº†å¾ˆå¤šä¸“é—¨é’ˆå¯¹åŸºæœ¬æ•°æ®ç±»å‹çš„æ–¹æ³•ï¼š

  ä¾‹å¦‚ï¼šmapToInt,mapToLong,mapToDouble,flatMapToInt,flatMapToDoubleç­‰ã€‚



```java
private static void test27() {

    List<Author> authors = getAuthors();
    authors.stream()
        .map(author -> author.getAge())		// åç»­éƒ½æ˜¯Stream<Integer>
        .map(age -> age + 10)
        .filter(age->age>18)
        .map(age->age+2)
        .forEach(System.out::println);

    authors.stream()
        .mapToInt(author -> author.getAge())	// åç»­éƒ½æ˜¯IntStream
        .map(age -> age + 10)
        .filter(age->age>18)
        .map(age->age+2)
        .forEach(System.out::println);
}
```



## å¹¶è¡Œæµ

- å½“æµä¸­æœ‰å¤§é‡å…ƒç´ æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¹¶è¡Œæµå»æé«˜æ“ä½œçš„æ•ˆç‡ã€‚

- å…¶å®å¹¶è¡Œæµå°±æ˜¯æŠŠä»»åŠ¡åˆ†é…ç»™å¤šä¸ªçº¿ç¨‹å»å®Œæˆã€‚

  å¦‚æœæˆ‘ä»¬è‡ªå·±å»ç”¨ä»£ç å®ç°çš„è¯å…¶å®ä¼šéå¸¸çš„å¤æ‚ï¼Œå¹¶ä¸”è¦æ±‚ä½ å¯¹å¹¶å‘ç¼–ç¨‹æœ‰è¶³å¤Ÿçš„ç†è§£å’Œè®¤è¯†ã€‚è€Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨Streamçš„è¯ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹ä¸€ä¸ªæ–¹æ³•çš„è°ƒç”¨å°±å¯ä»¥ä½¿ç”¨å¹¶è¡Œæµæ¥å¸®æˆ‘ä»¬å®ç°ï¼Œä»è€Œæé«˜æ•ˆç‡ã€‚



parallelæ–¹æ³•å¯ä»¥æŠŠä¸²è¡Œæµè½¬æ¢æˆå¹¶è¡Œæµï¼š

```java
    private static void test28() {
        Stream<Integer> stream = Stream.of(1, 2, 3, 4, 5, 6, 7, 8, 9, 10);
        Integer sum = stream.parallel()
                .peek(new Consumer<Integer>() {		// è¯¥æ–¹æ³•ä¸“é—¨ç”¨äºè°ƒè¯•ï¼Œå±äºä¸­é—´æ“ä½œ
                    @Override
                    public void accept(Integer num) {
                        System.out.println(num+Thread.currentThread().getName());
                    }
                })
                .filter(num -> num > 5)
                .reduce((result, ele) -> result + ele)
                .get();
        System.out.println(sum);
    }
```

ä¹Ÿå¯ä»¥é€šè¿‡parallelStreamç›´æ¥è·å–å¹¶è¡Œæµå¯¹è±¡ï¼š

```java
List<Author> authors = getAuthors();
authors.parallelStream()
    .map(author -> author.getAge())
    .map(age -> age + 10)
    .filter(age->age>18)
    .map(age->age+2)
    .forEach(System.out::println);
```

